{% extends "base.html" %}
{% load static %}
{% block content %}
    <div class="container">
        <div class="card shadow-sm rounded-3 p-2">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">{{ post.title }}</h2>
                <span class="text-muted small">
        üëÅÔ∏è {{ post.views_count }}
      </span>
            </div>

            <p class="text-muted">
                –ê–≤—Ç–æ—Ä:
                <strong>{{ post.author.username }}</strong> |
                {{ post.created_at|date:"d M Y, H:i" }}
            </p>

            {% if post.image %}
                <div class="text-center mb-4">
                    <img src="{{ post.image.url }}" alt="{{ post.title }}" class="img-fluid rounded">
                </div>
            {% endif %}

            <div class="content mb-4">
                {{ post.content|linebreaks }}
            </div>

            {% if user == post.author %}
                <div class="d-flex justify-content-center gap-2 mb-3">
                    <a href="{% url 'posts:edit_post' post.id %}" class="btn btn-outline-primary btn-sm">
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                    <a href="{% url 'posts:delete_post' post.id %}" class="btn btn-outline-danger btn-sm">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                    </a>
                    <a href="{% url 'posts:posts_list' %}" class="btn btn-secondary btn-sm">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ—Å—Ç–∞–º
                    </a>
                </div>
            {% else %}
                <div class="text-center mb-3">
                    <a href="{% url 'posts:posts_list' %}" class="btn btn-secondary btn-sm">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ—Å—Ç–∞–º
                    </a>
                </div>
            {% endif %}
            {% if user.is_authenticated %}
                <div class="mt-3">
                    <form method="post" action="{% url 'posts:add_comment' post.id %}">
                        {% csrf_token %}
                        {{ form.as_p }}
                        <button type="submit" class="btn btn-sm btn-primary mt-2">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</button>
                    </form>
                </div>
            {% else %}
                <p class="text-muted mt-2">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</p>
            {% endif %}
        </div>

        <h4>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h4>
        <div class="comments mt-0 mb-3">
            {% for comment in post.comments.all %}
                <div id="comment-{{ comment.id }}"
                     class="border-top pt-2 mt-2 d-flex justify-content-between align-items-center">
                    <div>
                        <strong>{{ comment.author.username }}</strong>: {{ comment.content }}
                        <span class="text-muted small">{{ comment.created_at|date:"d M Y H:i" }}</span>
                    </div>

                    {% if request.user == comment.author or request.user.is_superuser %}
                        <form method="post" action="{% url 'posts:delete_comment' comment.id %}"
                              style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" style="background:none; border:none; padding:0; cursor:pointer;">
                                <i class="fas fa-trash text-danger"></i>
                            </button>
                        </form>
                    {% endif %}
                </div>
            {% empty %}
                <p class="text-muted small">–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</p>
            {% endfor %}
        </div>
    </div>
{% endblock %}